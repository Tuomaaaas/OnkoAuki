<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Onko Alko auki?</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }

        .status {
            font-size: 2.5em;
        }

        .open {
            color: green;
        }

        .closed {
            color: red;
        }

        .countdown {
            font-size: 1.2em;
            color: gray;
        }
    </style>
</head>
<body>
<img src="./Alko_logo.png" width="128" height="128" alt="Alko logo">
<h1 id="status" class="status"></h1>
<div id="countdown" class="countdown"></div>

<script>
    function getHelsinkiTime() {
        const now = new Date();
        return new Date(now.toLocaleString("en-US", { timeZone: "Europe/Helsinki" }));
    }

    const specialHours = {
        '2024-06-20': { open: 9, close: 21 },
        '2024-06-21': { open: 9, close: 12 },
        '2024-06-22': { closed: true },
        '2024-11-01': { open: 9, close: 21 },
        '2024-11-02': { closed: true },
        '2024-12-05': { open: 9, close: 21 },
        '2024-12-06': { closed: true },
        '2024-12-24': { open: 9, close: 12 },
        '2024-12-25': { closed: true },
        '2024-12-26': { closed: true },
        '2024-12-31': { open: 9, close: 18 },
        '2025-01-01': { closed: true },
        '2025-01-06': { closed: true }
    };

    const regularHours = {
        1: { open: 9, close: 21 },
        2: { open: 9, close: 21 },
        3: { open: 9, close: 21 },
        4: { open: 9, close: 21 },
        5: { open: 9, close: 21 },
        6: { open: 9, close: 18 },
        0: { closed: true }
    };

    let updateInterval = 60000; // 1 minute
    let updateIntervalID;

    function formatDate(currentTime) {
        const year = currentTime.getFullYear();
        const month = String(currentTime.getMonth() + 1).padStart(2, '0');
        const day = String(currentTime.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function getTodayHours(currentTime) {
        const today = formatDate(currentTime);
        return specialHours[today] || regularHours[currentTime.getDay()];
    }

    function isAlkoOpen(currentTime, hours) {
        if (hours.closed) return false;
        const currentHour = currentTime.getHours();
        return currentHour >= hours.open && currentHour < hours.close;
    }

    function getNextOpeningTime(currentTime) {
        let nextTime = new Date(currentTime);
        while (true) {
            nextTime.setDate(nextTime.getDate() + 1);
            const hours = getTodayHours(nextTime);
            if (!hours.closed) {
                nextTime.setHours(hours.open, 0, 0, 0);
                return nextTime;
            }
        }
    }

    function calculateTimeUntil(currentTime, targetTime) {
        const timeDiffInSeconds = Math.floor((targetTime - currentTime) / 1000);
        const hours = Math.floor(timeDiffInSeconds / 3600);
        const minutes = Math.floor((timeDiffInSeconds % 3600) / 60);
        const seconds = timeDiffInSeconds % 60;
        return { hours, minutes, seconds };
    }

    function displayCountdown(timeRemaining) {
        if (timeRemaining.hours > 0) {
            return `${timeRemaining.hours} tunnin, ${timeRemaining.minutes} minuutin, ja ${timeRemaining.seconds} sekunnin päästä.`;
        } else if (timeRemaining.minutes > 0) {
            return `${timeRemaining.minutes} minuutin ja ${timeRemaining.seconds} sekunnin päästä.`;
        } else {
            return `${timeRemaining.seconds} sekunnin päästä.`;
        }
    }

    function checkAlkoStatus() {
        const currentTime = getHelsinkiTime();
        const hours = getTodayHours(currentTime);
        const statusElement = document.getElementById('status');
        const countdownElement = document.getElementById('countdown');

        let countdownVisible = false;

        if (isAlkoOpen(currentTime, hours)) {
            statusElement.textContent = "Alko on auki!";
            statusElement.className = 'status open';

            const closingTime = new Date(currentTime);
            closingTime.setHours(hours.close, 0, 0, 0);
            const timeUntilClose = calculateTimeUntil(currentTime, closingTime);

            if (timeUntilClose.hours < 1) {
                countdownVisible = true;
                countdownElement.textContent = `Alko sulkeutuu: ${timeUntilClose.minutes} minuutin ja ${timeUntilClose.seconds} sekunnin päästä.`;
            } else {
                countdownElement.textContent = '';
            }
        } else {
            statusElement.textContent = "Alko on kiinni!";
            statusElement.className = 'status closed';

            const nextOpeningTime = getNextOpeningTime(currentTime);
            const timeUntilOpen = calculateTimeUntil(currentTime, nextOpeningTime);

            if (timeUntilOpen.hours < 1) {
                countdownVisible = true;
            }
            countdownElement.textContent = `Alko avautuu: ${displayCountdown(timeUntilOpen)}`;
        }

        if (countdownVisible) {
            updateInterval = 1000; // 1-second if countdown is visible
        } else {
            updateInterval = 60000; // 1-minute if countdown is not visible
        }

        clearInterval(updateIntervalID);
        updateIntervalID = setInterval(checkAlkoStatus, updateInterval);
    }

    updateIntervalID = setInterval(checkAlkoStatus, updateInterval);
    checkAlkoStatus();
</script>
</body>
</html>
